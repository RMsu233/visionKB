# 卡尔曼滤波器

# 前言

* 曼滤波器（Kalman Filter），在RM这个比赛中，主要的作用就是在于预测。Filter，即滤波器，其实并不能很好的描述它的作用，它更像是一种预测器。
* 我个人是通过DR_CAN这位老师在b站的视频进行学习的，他讲解的非常之透彻，相信大家去看过之后，都会对KF有更直观的理解，消除对这个高大上名字莫名的害怕。(<https://space.bilibili.com/230105574?spm_id_from=333.337.search-card.all.click>)
* 在这里强烈建议，大家可以先去把这位老师的视频看过一遍之后，在来看这篇文章，当然先看再去也可以，很难能比这位老师把KF讲的更加透彻，而这篇文章的目的仅仅只是希望能使大家可以更快的理解什么是所谓的卡尔曼滤波。

# 一、核心公式

* 首先，在这里我默认大家已经看过第一个视频了，明白了那个核心公式的意义。

   "<center> $ K_{k} =\frac{e_{EST_{k-1} } }{e_{MST_{k-1}} + e_{MEA_{k}}} $</center>"
这个公式的目的在于判断当前的测量误差值是否合理，即 __$e_{MEA_{k}}$__ 是否合理。
倘若 __$e_{MEA_{k}}$__ 过大，则表示当前的测量值与先前的预测值相差特别大。这是一种不合理的表现。从而使得 __$K_{k}$__ 的值变小，即当前的测量值不可信。
* 具体特征表现在于 __$K_{k}$__ 的值只会在0~1之间变化。
越是接近于1，则表示当前的测量误差 __$e_{MEA_{k}}$__ 是符合先前的规律的；
若是接近于0，则表示当前的测量误差 __$e_{MEA_{k}}$__ 即越不符合我们的判断规律，即表示这个数据可信度低。
* 返回到我们视觉识别一个装甲板在移动的时候，原本装甲板在匀速移动，想来距离的增长即 vt 是稳定的，若是突然误识别到了远方的灯条，这个值肯定是不可信的，而测量误差也会表现的特别大，__$K_{k}$__ 就会把这个不良数据的影响，尽可能减小。
这就是这个核心公式的意义体现。
即：在预测过程中，尽可能地减少不良数据的影响。

* 而 __$K_{k}$__ 的具体由来，则要由我们所观测的对象自身的运动规律所决定。
  * 比如说dr_can第一节课里对于硬币直径的测量，直径测量值 __$z_{k}$__ 是围绕着直径这个固定的值不变的，会围绕在50上下一定范围内波动。
  * 而加入我们用来观测一个物体的匀速运动，那么这个不变的值就是它的速度。关于匀加速运动，那个不变的值自然就是它的加速度了。计算出 __$K_{k}$__ 的矩阵也要跟着变化。

# 二、数学基础

## 1.数据融合

* 这里主要考察两个概念，一个是线性代数中，关于正态分布及方差的概念。另一个则是关于高等数学中，拟合直线的概念。
  * 关于正态分布，在此处主要考察其图形性质。 __$\sigma$__ 即正态分布中的标准差，这个值越高，图像就越矮平，表示预测结果不可靠。这个值越低，图像表现就越瘦高，表示计算出来的结果更贴近真实值。 
  * 关于方差，这里视频里涉及两个公式。其为：
    {<center> $ D(X+Y)=D(X)+D(Y) $</center><center> $ D(aX)=a^{2} D(X) $</center>}
  关于线代这部分知识，不熟悉的同学建议复习一下。
  * 关于高数求极值部分，希望大家能回想一下关于最小二乘法部分的知识。本质就是为了返回一个最能贴近真实正确数据的值，具体的一些细节，大家可以到这一篇文章中去了解，文章链接：(<https://duskkkrua.github.io/2021/10/28/math/lease_linear/>)。

## 2.协方差矩阵

  * 在这一部分内容中,我想有必要补充一部分关于相关性的知识点,相关性的方程如下:
  {<center> $ \rho _{XY} = \frac{cov(X,Y)}{\sqrt{D(X)}\sqrt{D(Y)} }  $</center><center> $ cov(X,Y) = E(XY)-E(X)E(Y) $</center>}
  {<center> $   cov(X,X) = E(X^{2} )-E(X)^{2} =D(X) $</center><center> $ \rho _{XX} = \frac{cov(X,X)}{\sqrt{D(X)}\sqrt{D(X)}} = 1 $</center>}
  以上两对式子里, __$\rho$__ 即为相关性, __$ -1 \le \rho\le 1 $__,等于0表示不相关。

## 3.状态空间方程
  * 在这里,can老师举了一个例子,公式如下:
  
  {<center> $ m\ddot{x} + B\dot{x} +kx =F $</center>}
  这是控制原理部分的相关知识,看起来有点不能理解,但它只不过是ma + Bv + kx =F;
  k是弹簧的弹力系数.
  B是阻尼的阻尼系数.
  a是我们十分熟悉的加速度.
  这个式子就是一个对阻力的分析公式.$\dot{x} = v = \frac{\mathrm{d} x}{\mathrm{d} t} $ ,$\ddot{x} = a = \frac{\mathrm{d} \frac{\mathrm{d} x}{\mathrm{d} t} }{\mathrm{d} t} =\frac{\mathrm{d} v}{\mathrm{d} t}  $.

  如此而已,而具体的内容,如果感兴趣的话,我推荐可以学习由清华大学董景新老师讲的《控制工程基础》,同样在b站大学,我们这里只要简单了解原理就可以了.

  但我仍要强调一点,为什么这里要使用的是 $\ddot{x}$ 和 $\dot{x}$ 而不是v和t呢,因为我们在这个例子里,根本上要讨论的不是阻尼的速度,和重块的加速度及弹簧的伸缩量,最本质的自变量和因变量是**F力的大小** 和**包括滑块阻尼弹簧在内的整个系统向右移动了多少距离**,以及其中各部件随着距离于时间的变化,各自会发生什么变化.

  为什么这个叫做状态空间方程就是因为它描述的是这一整个系统之中,各个局部的参数所集合起来的系统的综合状态,切记在今后的项目过程中,要深切抓住这个重点。

  此外,强调两个重点。
  *  观看can老师视频的同时,遇到不理解的矩阵,建议将矩阵展开成等式来理解,有助于提高你对如何利用矩阵这一数学公式来表达数学关系的能力。
  *  思考关于过程噪音这一因素,因为是由我们来添加,值要定义在多大范围内。就好比硬币直径的测量误差,假如是2cm长,那绝对不可能有人测出1cm的误差出来。